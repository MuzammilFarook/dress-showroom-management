<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dress Showroom Management System</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <meta name="description" content="Comprehensive dress showroom management system">
    <meta name="author" content="Dress Showroom Management">
</head>
<body>
<div class="container">
    <!-- Login Form -->
    <div id="loginForm" class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">
            ğŸª SKY BLUE GROUPS - Showroom Management
        </h2>
        <form onsubmit="login(event)">
            <div class="form-group">
                <label for="loginUsername">Username</label>
                <input
                        type="text"
                        id="loginUsername"
                        name="username"
                        required
                        placeholder="Enter your username"
                        autocomplete="username"
                        autofocus>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input
                        type="password"
                        id="loginPassword"
                        name="password"
                        required
                        placeholder="Enter your password"
                        autocomplete="current-password">
            </div>
            <button type="submit" class="btn" style="width: 100%;">
                ğŸ” Login
            </button>
        </form>

        <div id="loginError" class="alert alert-error hidden" style="margin-top: 15px;">
            Invalid username or password. Please try again.
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #e8f4f8; border-radius: 8px; font-size: 12px;">
            <strong>ğŸ”‘ Demo Credentials:</strong><br>
            <strong>Owner:</strong> admin / admin123<br>
            <strong>Manager:</strong> manager1 / manager123<br>
            <strong>Sales Rep:</strong> sales1 / sales123<br>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <div class="header">
            <h1>ğŸª SKY BLUE GROUPS - Showroom Management</h1>
            <div class="user-info">
                <div>
                    <span><strong>ğŸ‘¤ User:</strong> <span id="currentUser"></span></span> |
                    <span><strong>ğŸ­ Role:</strong> <span id="currentRole"></span></span> |
                    <span><strong>ğŸ¢ Outlet:</strong> <span id="currentOutlet" class="outlet-indicator"></span></span>

                    <!-- Owner outlet selector -->
                    <span id="ownerOutletSelectorHolder" class="hidden" style="margin-left:10px;">
                            <label style="font-weight:600; margin-right:6px;">ğŸ“ View Outlet</label>
                            <select id="ownerOutletSelector" style="padding:6px 10px; border-radius:8px; border:1px solid #e0e6ed;">
                                <option value="">Select Outlet</option>
                            </select>
                        </span>
                </div>
                <div>
                    <button class="btn btn-sm" onclick="refreshAllData()" title="Refresh Data" style="margin-right: 10px;">
                        ğŸ”„ Refresh
                    </button>
                    <button class="btn btn-danger" onclick="logout()">
                        ğŸšª Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" id="tabDashboard" onclick="showTab('dashboard')" title="Alt+1">
                ğŸ“Š Dashboard
            </button>
            <button class="nav-tab hidden" id="tabSales" onclick="showTab('sales')" title="Alt+2">
                ğŸ’° Sales
            </button>
            <button class="nav-tab hidden" id="tabExpenses" onclick="showTab('expenses')" title="Alt+3">
                ğŸ’¸ Expenses
            </button>
            <button class="nav-tab hidden" id="tabUsers" onclick="showTab('users')" title="Alt+4">
                ğŸ‘¥ Users
            </button>
            <button class="nav-tab hidden" id="tabSalary" onclick="showTab('salary')" title="Alt+5">
                ğŸ’µ Salary
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardContent" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #2c3e50;">ğŸ“Š Dashboard Overview</h2>

            <div class="form-row" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="dashFromDate">ğŸ“… From Date</label>
                    <input type="date" id="dashFromDate" name="dashFromDate">
                </div>
                <div class="form-group">
                    <label for="dashToDate">ğŸ“… To Date</label>
                    <input type="date" id="dashToDate" name="dashToDate">
                </div>
            </div>
            <button class="btn" onclick="updateDashboard()">
                ğŸ”„ Update Dashboard
            </button>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalSalesDisplay">â‚¹0</div>
                    <div class="stat-label">ğŸ’° Total Sales</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                    <div class="stat-value" id="totalExpensesDisplay">â‚¹0</div>
                    <div class="stat-label">ğŸ’¸ Total Expenses</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954);">
                    <div class="stat-value" id="netProfitDisplay">â‚¹0</div>
                    <div class="stat-label">ğŸ“ˆ Sale Balance</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                    <div class="stat-value" id="totalTransactionsDisplay">0</div>
                    <div class="stat-label">ğŸ§¾ Total Transactions</div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ Recent Sales Activity</h3>
                <div class="table-container">
                    <table id="dashboardSalesTable">
                        <thead>
                        <tr>
                            <th>ğŸ“… Date</th>
                            <th>ğŸ‘¤ Sales Rep</th>
                            <th>ğŸ§¾ Bill No</th>
                            <th>ğŸ’° Amount</th>
                            <th>ğŸ’³ Payment</th>
                            <th>ğŸ¢ Outlet</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
                                Loading recent sales data...
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="salesContent" class="tab-content hidden">
            <h2 style="margin-bottom: 25px; color: #2c3e50;">ğŸ’° Sales Management</h2>

            <!-- Sales Entry Form -->
            <div id="salesEntryForm" class="card hidden">
                <h3 style="margin-bottom: 20px;">â• Add Sales Entry</h3>
                <form onsubmit="addSalesEntry(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newSalesRep">ğŸ‘¤ Sales Representative *</label>
                            <select id="newSalesRep" name="salesRep" required>
                                <option value="">Select Sales Rep</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newSalesDateTime">ğŸ“… Date & Time *</label>
                            <input type="datetime-local" id="newSalesDateTime" name="salesDateTime" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newBillNumber">ğŸ§¾ Bill Number *</label>
                            <input type="text" id="newBillNumber" name="billNumber" required placeholder="e.g., BILL001" pattern="[A-Za-z0-9]+">
                            <small style="color: #666; font-size: 11px;">Only letters and numbers allowed</small>
                        </div>
                        <div class="form-group">
                            <label for="newSalesAmount">ğŸ’° Amount (â‚¹) *</label>
                            <input type="number" id="newSalesAmount" name="salesAmount" step="0.01" min="0.01" max="1000000" required placeholder="0.00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newPaymentType">ğŸ’³ Payment Type *</label>
                        <select id="newPaymentType" name="paymentType" required>
                            <option value="">Select Payment Type</option>
                            <option value="CASH">ğŸ’µ Cash</option>
                            <option value="ACCOUNT">ğŸ¦ Account</option>
                        </select>
                    </div>
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">
                            âœ… Add Sales Entry
                        </button>
                        <button type="button" class="btn" onclick="clearSalesForm()">
                            ğŸ§¹ Clear Form
                        </button>
                    </div>
                </form>
            </div>

            <!-- Sales Records View -->
            <div class="card">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ Sales Records</h3>
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="salesFilterFromDate">ğŸ“… From Date</label>
                        <input type="date" id="salesFilterFromDate" name="salesFromDate">
                    </div>
                    <div class="form-group">
                        <label for="salesFilterToDate">ğŸ“… To Date</label>
                        <input type="date" id="salesFilterToDate" name="salesToDate">
                    </div>
                </div>
                <div class="form-row" style="margin-bottom: 20px;" id="salesRepFilterRow">
                    <div class="form-group">
                        <label for="salesRepFilterSelect">ğŸ‘¤ Filter by Sales Rep</label>
                        <select id="salesRepFilterSelect" name="salesRepFilter">
                            <option value="">All Sales Representatives</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="paymentTypeFilterSelect">ğŸ’³ Payment Type Filter</label>
                        <select id="paymentTypeFilterSelect" name="paymentTypeFilter">
                            <option value="">All Payment Types</option>
                            <option value="CASH">ğŸ’µ Cash</option>
                            <option value="ACCOUNT">ğŸ¦ Account</option>
                        </select>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="loadSalesData()">
                        ğŸ” Apply Filters
                    </button>
                    <button class="btn btn-warning" onclick="exportSalesData()">
                        ğŸ“¥ Export to CSV
                    </button>
                </div>

                <div class="table-container">
                    <table id="salesRecordsTable">
                        <thead>
                        <tr>
                            <th>ğŸ“… Date & Time</th>
                            <th>ğŸ‘¤ Sales Rep</th>
                            <th>ğŸ§¾ Bill Number</th>
                            <th>ğŸ’° Amount</th>
                            <th>ğŸ’³ Payment Type</th>
                            <th>ğŸ¢ Outlet</th>
                            <th id="createdByHeader" class="hidden">ğŸ‘¨â€ğŸ’¼ Created By</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px; color: #666;">
                                Loading sales data...
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expensesContent" class="tab-content hidden">
            <h2 style="margin-bottom: 25px; color: #2c3e50;">ğŸ’¸ Expense Management</h2>

            <div class="card">
                <h3 style="margin-bottom: 20px;">â• Add Expense</h3>
                <form onsubmit="addExpense(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newExpenseType">ğŸ“ Expense Type *</label>
                            <select id="newExpenseType" name="expenseType" required onchange="handleExpenseTypeChange()">
                                <option value="">Select Expense Type</option>
                                <option value="TEA">â˜• Tea</option>
                                <option value="MESS">ğŸ½ï¸ Mess</option>
                                <option value="DINNER">ğŸ½ï¸ Dinner</option>
                                <option value="BREAKFAST">ğŸ¥ Breakfast</option>
                                <option value="LUNCH">ğŸ± Lunch</option>
                                <option value="CHARITY">â¤ï¸ Charity</option>
                                <option value="CHIT_FUND">ğŸ’° Chit Fund</option>
                                <option value="ADVANCE">ğŸ’µ Advance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newExpenseAmount">ğŸ’° Amount (â‚¹) *</label>
                            <input type="number" id="newExpenseAmount" name="expenseAmount" step="0.01" min="0.01" required placeholder="0.00">
                        </div>
                    </div>
                    <div class="form-group hidden" id="advanceToGroup">
                        <label for="newAdvanceTo">ğŸ‘¤ Advance To (Sales Representative) *</label>
                        <select id="newAdvanceTo" name="advanceTo">
                            <option value="">Select Sales Rep</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newExpenseDate">ğŸ“… Date *</label>
                        <input type="date" id="newExpenseDate" name="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="newExpenseDescription">ğŸ“ Description</label>
                        <textarea id="newExpenseDescription" name="expenseDescription" rows="3" placeholder="Optional description"></textarea>
                    </div>
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">
                            âœ… Add Expense
                        </button>
                        <button type="button" class="btn" onclick="clearExpenseForm()">
                            ğŸ§¹ Clear Form
                        </button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ Expense Records</h3>
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="expenseFilterFromDate">ğŸ“… From Date</label>
                        <input type="date" id="expenseFilterFromDate" name="expenseFromDate">
                    </div>
                    <div class="form-group">
                        <label for="expenseFilterToDate">ğŸ“… To Date</label>
                        <input type="date" id="expenseFilterToDate" name="expenseToDate">
                    </div>
                </div>
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="expenseTypeFilterSelect">ğŸ“ Expense Type Filter</label>
                        <select id="expenseTypeFilterSelect" name="expenseTypeFilter">
                            <option value="">All Expense Types</option>
                            <option value="TEA">â˜• Tea</option>
                            <option value="MESS">ğŸ½ï¸ Mess</option>
                            <option value="DINNER">ğŸ½ï¸ Dinner</option>
                            <option value="BREAKFAST">ğŸ¥ Breakfast</option>
                            <option value="LUNCH">ğŸ± Lunch</option>
                            <option value="CHARITY">â¤ï¸ Charity</option>
                            <option value="CHIT_FUND">ğŸ’° Chit Fund</option>
                            <option value="ADVANCE">ğŸ’µ Advance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="advanceToFilterSelect">ğŸ‘¤ Advance To Filter</label>
                        <select id="advanceToFilterSelect" name="advanceToFilter">
                            <option value="">All Employees</option>
                        </select>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="loadExpenseData()">
                        ğŸ” Apply Filters
                    </button>
                    <button class="btn btn-warning" onclick="exportExpenseData()">
                        ğŸ“¥ Export to CSV
                    </button>
                </div>

                <div class="table-container">
                    <table id="expenseRecordsTable">
                        <thead>
                        <tr>
                            <th>ğŸ“… Date</th>
                            <th>ğŸ“ Type</th>
                            <th>ğŸ’° Amount</th>
                            <th>ğŸ“ Description</th>
                            <th>ğŸ‘¤ Advance To</th>
                            <th>ğŸ¢ Outlet</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
                                Loading expense data...
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- User Management Tab -->
        <div id="usersContent" class="tab-content hidden">
            <h2 style="margin-bottom: 25px; color: #2c3e50;">ğŸ‘¥ User Management</h2>

            <div class="card">
                <h3 style="margin-bottom: 20px;">â• Add New User</h3>
                <form onsubmit="addUser(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUserUsername">ğŸ‘¤ Username *</label>
                            <input type="text" id="newUserUsername" name="username" required placeholder="e.g., sales7" pattern="[a-zA-Z0-9_]+">
                            <small style="color: #666; font-size: 11px;">Letters, numbers, and underscore only</small>
                        </div>
                        <div class="form-group">
                            <label for="newUserFullName">ğŸ“ Full Name *</label>
                            <input type="text" id="newUserFullName" name="fullName" required placeholder="e.g., John Doe">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUserRole">ğŸ­ Role *</label>
                            <select id="newUserRole" name="role" required>
                                <option value="">Select Role</option>
                                <option value="OWNER">ğŸ‘‘ Owner</option>
                                <option value="MANAGER">ğŸ‘¨â€ğŸ’¼ Manager</option>
                                <option value="SALES">ğŸ‘¤ Sales Representative</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newUserOutlet">ğŸ¢ Outlet *</label>
                            <select id="newUserOutlet" name="outlet" required>
                                <option value="">Select Outlet</option>
                                <option value="SKY_BLUE_WOMEN">ğŸª SKY_BLUE_WOMEN</option>

                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">
                            âœ… Add User
                        </button>
                        <button type="button" class="btn" onclick="clearUserForm()">
                            ğŸ§¹ Clear Form
                        </button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">ğŸ“‹ Existing Users</h3>
                <div class="table-container">
                    <table id="userManagementTable">
                        <thead>
                        <tr>
                            <th>ğŸ‘¤ Username</th>
                            <th>ğŸ“ Full Name</th>
                            <th>ğŸ­ Role</th>
                            <th>ğŸ¢ Outlet</th>
                            <th>âš™ï¸ Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px; color: #666;">
                                Loading user data...
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Salary Statement Tab -->
        <div id="salaryContent" class="tab-content hidden">
            <h2 style="margin-bottom: 25px; color: #2c3e50;">ğŸ’µ Salary Statement Generator</h2>

            <div class="card">
                <h3 style="margin-bottom: 20px;">ğŸ“Š Generate Salary Statement</h3>
                <form onsubmit="generateSalaryStatement(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="salaryEmployeeSelect">ğŸ‘¤ Sales Representative *</label>
                            <select id="salaryEmployeeSelect" name="employeeUsername" required>
                                <option value="">Select Employee</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="salaryIncentivePercentage">ğŸ’¯ Incentive Percentage (%) *</label>
                            <input type="number" id="salaryIncentivePercentage" name="incentivePercentage" step="0.01" min="0" max="100" required placeholder="e.g., 2.5">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="salaryPeriodFromDate">ğŸ“… From Date *</label>
                            <input type="date" id="salaryPeriodFromDate" name="fromDate" required>
                        </div>
                        <div class="form-group">
                            <label for="salaryPeriodToDate">ğŸ“… To Date *</label>
                            <input type="date" id="salaryPeriodToDate" name="toDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="salaryBaseSalary">ğŸ’° Base Salary (â‚¹) *</label>
                        <input type="number" id="salaryBaseSalary" name="baseSalary" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">
                            ğŸ“Š Generate Statement
                        </button>
                        <button type="button" class="btn" onclick="clearSalaryForm()">
                            ğŸ§¹ Clear Form
                        </button>
                    </div>
                </form>
            </div>

            <div id="salaryStatementResult" class="hidden"></div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; justify-content: center; align-items: center;">
    <div style="background: white; padding: 30px; border-radius: 10px; text-align: center;">
        <div class="loading" style="margin: 0 auto 15px;"></div>
        <p>Loading...</p>
    </div>
</div>

<!-- JavaScript Files -->
<script src="/js/utils.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/sales.js"></script>
<script src="/js/expenses.js"></script>
<script src="/js/users.js"></script>
<script src="/js/salary.js"></script>
<script src="/js/app.js"></script>
</body>
</html>